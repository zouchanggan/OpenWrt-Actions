# ğŸš€ OpenWrt ç¼–è¯‘æœ€ä¼˜æ–¹æ¡ˆ - å®Œæ•´ç‰ˆ
# è§£å†³é¦–æ¬¡ç¼–è¯‘è¶…æ—¶ + æå‡ç¼“å­˜å‘½ä¸­ç‡è‡³75%+
# Author: ä¼˜åŒ–ç‰ˆæœ¬ v2.0
name: ğŸ’» Build OpenWrt (x86_64)
permissions:
  contents: write
  actions: read
on:
  workflow_dispatch:
    inputs:
      lan_addr:
        description: "ğŸ“ é»˜è®¤ LAN åœ°å€"
        default: "192.168.1.200"
        required: true
        type: string
      root_password:
        description: "ğŸ”‘ Root å¯†ç "
        default: "password"
        required: false
        type: string
      docker:
        description: "ğŸ‹ Docker æ”¯æŒ"
        type: boolean
        default: true
      ssrp:
        description: "ğŸš€ ShadowSocksR Plus+"
        type: boolean
        default: true
      passwall:
        description: "ğŸŒ Passwall"
        type: boolean
        default: true
      nikki:
        description: "ğŸ“¦ Nikki"
        type: boolean
        default: true
      openclash:
        description: "âš¡ OpenClash"
        type: boolean
        default: true
      lucky:
        description: "ğŸ€ Lucky"
        type: boolean
        default: true
      oaf:
        description: "ğŸ›¡ï¸ OpenAppFilter"
        type: boolean
        default: true
      compile_mode:
        description: "ğŸ”¨ ç¼–è¯‘æ¨¡å¼"
        type: choice
        options:
          - "fast"      # å¿«é€Ÿæ¨¡å¼ï¼ˆåˆ†é˜¶æ®µï¼‰
          - "standard"  # æ ‡å‡†æ¨¡å¼
          - "full"      # å®Œæ•´æ¨¡å¼
        default: "fast"
env:
  REPO_URL: https://github.com/openwrt/openwrt
  REPO_BRANCH: openwrt-24.10
  CONFIG_FILE: configs/x86_64.config
  DIY_SCRIPT: scripts/diy-x86_64_demo.sh
  FEEDS_CONF: feeds.conf.default
  CLASH_KERNEL: amd64
  UPLOAD_ARTIFACTS: false
  UPLOAD_RELEASE: true
  FIRMWARE_TAG: X86_64
  TZ: Asia/Shanghai
  DEBIAN_FRONTEND: noninteractive
concurrency:
  group: openwrt-build-${{ github.ref }}-${{ github.event.inputs.compile_mode }}
  cancel-in-progress: true
jobs:
  # ============================================
  # ğŸ“‹ é¢„æ£€æŸ¥é˜¶æ®µ - æ™ºèƒ½å†³ç­–ç¼–è¯‘ç­–ç•¥
  # ============================================
  pre-check:
    name: ğŸ“‹ é¢„æ£€æŸ¥ä¸ç­–ç•¥å†³ç­–
    runs-on: ubuntu-latest
    timeout-minutes: 10
    outputs:
      should_build: ${{ steps.decision.outputs.should_build }}
      compile_strategy: ${{ steps.decision.outputs.strategy }}
      cache_key_base: ${{ steps.cache-key.outputs.base }}
      config_hash: ${{ steps.cache-key.outputs.config_hash }}
      feeds_hash: ${{ steps.cache-key.outputs.feeds_hash }}
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
      - name: ğŸ§  ç”Ÿæˆæ™ºèƒ½ç¼“å­˜é”®
        id: cache-key
        run: |
          # ğŸ¯ åŸºäºæ–‡ä»¶å†…å®¹ç”Ÿæˆç¨³å®šç¼“å­˜é”®
          CONFIG_HASH=$(sha256sum configs/x86_64.config | cut -c1-12)
          FEEDS_HASH=$(sha256sum feeds.conf.default 2>/dev/null | cut -c1-8 || echo "default")
          
          # ğŸ”„ æœˆåº¦åˆ·æ–°ç­–ç•¥
          MONTH_KEY=$(date +'%Y%m')
          WEEK_KEY=$(date +'%Y%U')
          
          # ğŸ¯ æ’ä»¶ç»„åˆhashï¼ˆä»…ç”¨äºæ˜¾ç¤ºï¼‰
          PLUGINS_CONFIG="${{ github.event.inputs.docker }}-${{ github.event.inputs.ssrp }}-${{ github.event.inputs.passwall }}-${{ github.event.inputs.openclash }}-${{ github.event.inputs.nikki }}-${{ github.event.inputs.lucky }}-${{ github.event.inputs.oaf }}"
          PLUGINS_HASH=$(echo "$PLUGINS_CONFIG" | sha256sum | cut -c1-8)
          
          # åŸºç¡€ç¼“å­˜é”®ï¼ˆç¨³å®šä¸å˜ï¼‰
          CACHE_BASE="${{ env.REPO_BRANCH }}-${CONFIG_HASH}-${MONTH_KEY}"
          
          {
            echo "base=$CACHE_BASE"
            echo "config_hash=$CONFIG_HASH"
            echo "feeds_hash=$FEEDS_HASH"
            echo "month_key=$MONTH_KEY"
            echo "week_key=$WEEK_KEY"
            echo "plugins_hash=$PLUGINS_HASH"
          } >> $GITHUB_OUTPUT
          
          echo "ğŸ¯ ç¼“å­˜ç­–ç•¥ä¿¡æ¯:"
          echo "  é…ç½®Hash: $CONFIG_HASH"
          echo "  Feeds Hash: $FEEDS_HASH"
          echo "  æ’ä»¶Hash: $PLUGINS_HASH"
          echo "  ç¼“å­˜åŸºç¡€é”®: $CACHE_BASE"
      - name: ğŸ¤” ç¼–è¯‘ç­–ç•¥å†³ç­–
        id: decision
        run: |
          STRATEGY="${{ github.event.inputs.compile_mode }}"
          
          # æ ¹æ®è¾“å…¥å†³å®šç¼–è¯‘ç­–ç•¥
          case "$STRATEGY" in
            "fast")
              echo "ğŸš€ é€‰æ‹©å¿«é€Ÿç¼–è¯‘æ¨¡å¼ï¼ˆåˆ†é˜¶æ®µï¼‰"
              echo "strategy=staged" >> $GITHUB_OUTPUT
              ;;
            "standard") 
              echo "âš–ï¸ é€‰æ‹©æ ‡å‡†ç¼–è¯‘æ¨¡å¼"
              echo "strategy=standard" >> $GITHUB_OUTPUT
              ;;
            "full")
              echo "ğŸ”¥ é€‰æ‹©å®Œæ•´ç¼–è¯‘æ¨¡å¼"
              echo "strategy=full" >> $GITHUB_OUTPUT
              ;;
          esac
          
          echo "should_build=true" >> $GITHUB_OUTPUT
  # ============================================
  # ğŸ”§ å·¥å…·é“¾é¢„ç¼–è¯‘é˜¶æ®µï¼ˆä»…å¿«é€Ÿæ¨¡å¼ï¼‰
  # ============================================
  prepare-toolchain:
    name: ğŸ”§ é¢„ç¼–è¯‘å·¥å…·é“¾
    if: needs.pre-check.outputs.compile_strategy == 'staged'
    needs: pre-check
    runs-on: ubuntu-24.04
    timeout-minutes: 280  # 4å°æ—¶40åˆ†é’Ÿ
    outputs:
      toolchain_ready: ${{ steps.toolchain.outputs.ready }}
      toolchain_cache_hit: ${{ steps.cache-toolchain.outputs.cache-hit }}
    steps:
      - name: ğŸ§¹ é‡Šæ”¾ç£ç›˜ç©ºé—´
        uses: sbwml/actions@free-disk
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4
      - name: ğŸ› ï¸ æ„å»ºç³»ç»Ÿè®¾ç½®
        uses: sbwml/actions@openwrt-build-setup
      - name: ğŸ“¦ å®‰è£… LLVM
        uses: sbwml/actions@install-llvm
      - name: ğŸ’¾ å†…å­˜ä¸äº¤æ¢ä¼˜åŒ–
        run: |
          # åˆ›å»ºæ›´å¤§çš„äº¤æ¢ç©ºé—´
          sudo fallocate -l 12G /swapfile
          sudo chmod 600 /swapfile
          sudo mkswap /swapfile
          sudo swapon /swapfile
          
          # ä¼˜åŒ–å†…å­˜å‚æ•°
          sudo tee -a /etc/sysctl.conf >/dev/null <<EOF
          vm.swappiness=5
          vm.vfs_cache_pressure=40
          vm.dirty_ratio=20
          vm.dirty_background_ratio=10
          vm.overcommit_memory=1
          EOF
          sudo sysctl -p
          
          echo "ğŸ’¾ å†…å­˜çŠ¶æ€:"
          free -h
      - name: ğŸ“¥ å‡†å¤‡ OpenWrt æºç 
        run: |
          echo "ğŸ“¥ å…‹éš† OpenWrt æºç ..."
          for attempt in 1 2 3; do
            if git clone --depth=1 "$REPO_URL" -b "$REPO_BRANCH" openwrt; then
              break
            fi
            echo "âŒ ç¬¬ $attempt æ¬¡å…‹éš†å¤±è´¥"
            rm -rf openwrt
            [ $attempt -lt 3 ] && sleep 15
          done
          
          cd openwrt
          echo "OPENWRT_PATH=$PWD" >> $GITHUB_ENV
          
          # è·å–æäº¤ä¿¡æ¯
          COMMIT_HASH=$(git rev-parse HEAD)
          COMMIT_DATE=$(git log -1 --format="%ci")
          echo "COMMIT_HASH=$COMMIT_HASH" >> $GITHUB_ENV
          echo "COMMIT_DATE=$COMMIT_DATE" >> $GITHUB_ENV
      - name: ğŸ“š é…ç½® Feeds
        run: |
          cd "$OPENWRT_PATH"
          
          # æ¸…ç†å¹¶é…ç½® feeds
          rm -rf feeds tmp/packagecache
          
          if [ -f "${{ github.workspace }}/feeds.conf.default" ]; then
            cp "${{ github.workspace }}/feeds.conf.default" .
            echo "ğŸ“„ Using custom feeds.conf.default"
          else
            echo "::warning::feeds.conf.default not found, using upstream defaults."
          fi
          
          ./scripts/feeds update -a
          ./scripts/feeds install -a
      - name: â˜ï¸ å·¥å…·é“¾ç¼“å­˜
        id: cache-toolchain
        uses: actions/cache@v4
        with:
          path: |
            openwrt/staging_dir/toolchain-*
            openwrt/build_dir/toolchain-*
            openwrt/staging_dir/host*
            openwrt/staging_dir/hostpkg
          key: toolchain-ultimate-${{ needs.pre-check.outputs.cache_key_base }}-v15
          restore-keys: |
            toolchain-ultimate-${{ needs.pre-check.outputs.cache_key_base }}-
            toolchain-ultimate-${{ env.REPO_BRANCH }}-${{ needs.pre-check.outputs.config_hash }}-
      - name: ğŸ¨ åº”ç”¨é…ç½®
        run: |
          cd "$OPENWRT_PATH"
          
          # å¤åˆ¶é…ç½®æ–‡ä»¶
          cp "${{ github.workspace }}/$CONFIG_FILE" .config
          
          # æ‰§è¡Œè‡ªå®šä¹‰è„šæœ¬
          if [ -f "${{ github.workspace }}/$DIY_SCRIPT" ]; then
            chmod +x "${{ github.workspace }}/$DIY_SCRIPT"
            "${{ github.workspace }}/$DIY_SCRIPT"
          fi
          
          # ç”Ÿæˆé…ç½®
          make defconfig
          
          # æå–ç›®æ ‡ä¿¡æ¯
          DEVICE_TARGET=$(awk -F'"' '/^CONFIG_TARGET_BOARD=/{print $2}' .config || echo "x86")
          DEVICE_SUBTARGET=$(awk -F'"' '/^CONFIG_TARGET_SUBTARGET=/{print $2}' .config || echo "64")
          echo "DEVICE_TARGET=$DEVICE_TARGET" >> $GITHUB_ENV
          echo "DEVICE_SUBTARGET=$DEVICE_SUBTARGET" >> $GITHUB_ENV
      - name: ğŸ”¨ ç¼–è¯‘å·¥å…·é“¾
        id: toolchain
        timeout-minutes: 240
        run: |
          cd "$OPENWRT_PATH"
          
          echo "ğŸ”¨ å¼€å§‹å·¥å…·é“¾ç¼–è¯‘ ($(date))"
          echo "ğŸ’» CPUæ ¸å¿ƒ: $(nproc)"
          echo "ğŸ’¾ å¯ç”¨å†…å­˜: $(free -h | grep '^Mem:' | awk '{print $7}')"
          
          # æ£€æŸ¥ç¼“å­˜å‘½ä¸­
          if [ "${{ steps.cache-toolchain.outputs.cache-hit }}" == "true" ]; then
            echo "ğŸ¯ å·¥å…·é“¾ç¼“å­˜å‘½ä¸­ï¼Œè·³è¿‡ç¼–è¯‘"
            echo "ready=true" >> $GITHUB_OUTPUT
            exit 0
          fi
          
          # ç¼–è¯‘å·¥å…·é“¾
          echo "ğŸ”¨ ç¼–è¯‘ tools..."
          make tools/compile -j$(nproc) || make tools/compile -j1 V=s
          
          echo "ğŸ”¨ ç¼–è¯‘ toolchain..."
          make toolchain/compile -j$(nproc) || make toolchain/compile -j1 V=s
          
          echo "âœ… å·¥å…·é“¾ç¼–è¯‘å®Œæˆ"
          echo "ready=true" >> $GITHUB_OUTPUT
  # ============================================
  # ğŸ—ï¸ ä¸»ç¼–è¯‘é˜¶æ®µ
  # ============================================
  build-firmware:
    name: ğŸ—ï¸ ç¼–è¯‘ OpenWrt å›ºä»¶
    needs: [pre-check, prepare-toolchain]
    if: |
      always() && 
      needs.pre-check.outputs.should_build == 'true' && 
      (needs.prepare-toolchain.result == 'success' || needs.prepare-toolchain.result == 'skipped')
    runs-on: ubuntu-24.04
    timeout-minutes: 240
    outputs:
      firmware_path: ${{ steps.organize.outputs.firmware_path }}
      kernel_version: ${{ steps.organize.outputs.kernel_version }}
      compile_status: ${{ steps.compile.outputs.status }}
    steps:
      # ============================================
      # ç¯å¢ƒå‡†å¤‡
      # ============================================
      - name: ğŸ§¹ é‡Šæ”¾ç£ç›˜ç©ºé—´
        uses: sbwml/actions@free-disk
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4
      - name: ğŸ› ï¸ æ„å»ºç³»ç»Ÿè®¾ç½®
        uses: sbwml/actions@openwrt-build-setup
      - name: ğŸ“¦ å®‰è£… LLVM
        uses: sbwml/actions@install-llvm
      - name: ğŸ’¾ ç³»ç»Ÿä¼˜åŒ–
        run: |
          # å†…å­˜ä¼˜åŒ–
          sudo fallocate -l 12G /swapfile
          sudo chmod 600 /swapfile
          sudo mkswap /swapfile
          sudo swapon /swapfile
          
          # ç³»ç»Ÿå‚æ•°ä¼˜åŒ–
          sudo tee -a /etc/sysctl.conf >/dev/null <<EOF
          vm.swappiness=5
          vm.vfs_cache_pressure=40
          vm.dirty_ratio=20
          vm.dirty_background_ratio=10
          vm.overcommit_memory=1
          kernel.pid_max=4194304
          EOF
          sudo sysctl -p
          
          # æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
          echo "* soft nofile 65536" | sudo tee -a /etc/security/limits.conf
          echo "* hard nofile 65536" | sudo tee -a /etc/security/limits.conf
          
          # æ¸…ç†ä¸å¿…è¦çš„è½¯ä»¶åŒ…
          sudo apt-get autoremove -y
          sudo apt-get clean
          
          echo "ğŸ“Š ç³»ç»Ÿèµ„æºçŠ¶æ€:"
          echo "ğŸ’¾ å†…å­˜: $(free -h | grep '^Mem:' | awk '{print $2 " total, " $7 " available"}')"
          echo "ğŸ’¿ ç£ç›˜: $(df -h / | tail -1 | awk '{print $4 " available"}')"
          echo "ğŸ”§ CPU: $(nproc) cores"
      - name: â° æ„å»ºä¿¡æ¯åˆå§‹åŒ–
        run: |
          # æ„å»ºä¿¡æ¯
          BUILD_START_TIME=$(date +%s)
          VERSION=$(date +'%Y.%m.%d')
          DATE=$(date +'%Y-%m-%d %H:%M:%S')
          BUILD_ID="${{ github.run_number }}-${GITHUB_SHA::7}"
          FILE_DATE=$(date +'%Y.%m.%d-%H%M')
          
          # è‡ªåŠ¨å¹¶è¡Œè®¡ç®—
          PROC_COUNT=$(nproc)
          MEM_GB=$(($(free -m | awk '/^Mem:/{print $2}') / 1024))
          JOBS=$((MEM_GB / 3))  # æ›´ä¿å®ˆçš„å†…å­˜è®¡ç®—
          JOBS=$((JOBS > PROC_COUNT ? PROC_COUNT : JOBS))
          JOBS=$((JOBS < 1 ? 1 : JOBS))
          
          {
            echo "BUILD_START_TIME=$BUILD_START_TIME"
            echo "BUILD_VERSION=$VERSION"
            echo "BUILD_DATE=$DATE"
            echo "BUILD_ID=$BUILD_ID"
            echo "FILE_DATE=$FILE_DATE"
            echo "COMPILE_JOBS=$JOBS"
          } >> $GITHUB_ENV
          
          echo "ğŸš€ æ„å»ºä¿¡æ¯:"
          echo "  ç‰ˆæœ¬: $VERSION"
          echo "  æ—¶é—´: $DATE"
          echo "  ID: $BUILD_ID"
          echo "  å¹¶è¡Œæ•°: $JOBS"
          echo "  ç¼–è¯‘ç­–ç•¥: ${{ needs.pre-check.outputs.compile_strategy }}"
      # ============================================
      # æºç å‡†å¤‡
      # ============================================
      - name: ğŸ“¥ å‡†å¤‡ OpenWrt æºç 
        run: |
          echo "ğŸ“¥ å…‹éš† OpenWrt æºç ..."
          
          for attempt in 1 2 3; do
            if git clone --depth=1 "$REPO_URL" -b "$REPO_BRANCH" openwrt; then
              break
            fi
            echo "âŒ ç¬¬ $attempt æ¬¡å…‹éš†å¤±è´¥"
            rm -rf openwrt
            [ $attempt -lt 3 ] && sleep 15
          done
          
          cd openwrt
          echo "OPENWRT_PATH=$PWD" >> $GITHUB_ENV
          
          # è·å–æäº¤ä¿¡æ¯
          COMMIT_INFO=$(git log -1 --pretty=format:'%an|%ci|%s|%H')
          IFS='|' read -r AUTHOR COMMIT_DATE MESSAGE HASH <<< "$COMMIT_INFO"
          
          {
            echo "COMMIT_AUTHOR=${AUTHOR}"
            echo "COMMIT_DATE=${COMMIT_DATE}"
            echo "COMMIT_MESSAGE=${MESSAGE}"
            echo "COMMIT_HASH=${HASH}"
          } >> $GITHUB_ENV
      - name: ğŸ“š é…ç½® Feeds
        run: |
          cd "$OPENWRT_PATH"
          
          rm -rf feeds tmp/packagecache
          
          if [ -f "${{ github.workspace }}/feeds.conf.default" ]; then
            cp "${{ github.workspace }}/feeds.conf.default" .
            echo "ğŸ“„ Using custom feeds.conf.default"
          else
            echo "::warning::feeds.conf.default not found, using upstream defaults."
          fi
          
          echo "ğŸ”„ æ›´æ–° feeds..."
          ./scripts/feeds update -a
          echo "ğŸ“¦ å®‰è£… feeds..."
          ./scripts/feeds install -a
      # ============================================
      # é«˜çº§ç¼“å­˜ç­–ç•¥
      # ============================================
      - name: â˜ï¸ å·¥å…·é“¾ç¼“å­˜ï¼ˆç»§æ‰¿/ç‹¬ç«‹ï¼‰
        if: needs.pre-check.outputs.compile_strategy != 'staged'
        uses: actions/cache@v4
        with:
          path: |
            openwrt/staging_dir/toolchain-*
            openwrt/build_dir/toolchain-*
          key: toolchain-ultimate-${{ needs.pre-check.outputs.cache_key_base }}-v15
          restore-keys: |
            toolchain-ultimate-${{ needs.pre-check.outputs.cache_key_base }}-
            toolchain-ultimate-${{ env.REPO_BRANCH }}-${{ needs.pre-check.outputs.config_hash }}-
      - name: â˜ï¸ Host å·¥å…·ç¼“å­˜
        uses: actions/cache@v4
        with:
          path: |
            openwrt/staging_dir/host*
            openwrt/staging_dir/hostpkg
          key: hosttools-${{ needs.pre-check.outputs.cache_key_base }}-v12
          restore-keys: |
            hosttools-${{ needs.pre-check.outputs.cache_key_base }}-
            hosttools-${{ env.REPO_BRANCH }}-${{ needs.pre-check.outputs.config_hash }}-
      - name: â˜ï¸ æ„å»ºä¾èµ–ç¼“å­˜
        uses: actions/cache@v4
        with:
          path: |
            openwrt/build_dir/host*
          key: buildhost-${{ needs.pre-check.outputs.cache_key_base }}-v10
          restore-keys: |
            buildhost-${{ needs.pre-check.outputs.cache_key_base }}-
            buildhost-${{ env.REPO_BRANCH }}-${{ needs.pre-check.outputs.config_hash }}-
      - name: â˜ï¸ ä¸‹è½½ç¼“å­˜
        uses: actions/cache@v4
        with:
          path: openwrt/dl
          key: downloads-${{ env.REPO_BRANCH }}-${{ needs.pre-check.outputs.config_hash }}-v8
          restore-keys: |
            downloads-${{ env.REPO_BRANCH }}-${{ needs.pre-check.outputs.config_hash }}-
            downloads-${{ env.REPO_BRANCH }}-
      - name: â˜ï¸ ccache ç¼–è¯‘ç¼“å­˜
        if: github.event.inputs.force_clean != 'true'
        uses: actions/cache@v4
        with:
          path: openwrt/.ccache
          key: ccache-${{ needs.pre-check.outputs.cache_key_base }}-${{ github.run_number }}-v12
          restore-keys: |
            ccache-${{ needs.pre-check.outputs.cache_key_base }}-
            ccache-${{ env.REPO_BRANCH }}-${{ needs.pre-check.outputs.config_hash }}-
      # ============================================
      # ccache ä¼˜åŒ–é…ç½®
      # ============================================
      - name: ğŸ¯ ccache é«˜æ€§èƒ½é…ç½®
        run: |
          cd "$OPENWRT_PATH"
          
          export USE_CCACHE=1
          export CCACHE_DIR="$PWD/.ccache"
          export PATH="/usr/lib/ccache:$PATH"
          
          mkdir -p "$CCACHE_DIR"
          
          # ğŸš€ æ¿€è¿›çš„ccacheé…ç½®
          ccache -M 30G  # 30GB ç¼“å­˜
          ccache -F 800000  # 80ä¸‡æ–‡ä»¶
          
          # ğŸ¯ é«˜å‘½ä¸­ç‡é…ç½®
          ccache --set-config=compression=true
          ccache --set-config=compression_level=1
          ccache --set-config=stats=true
          ccache --set-config=max_files=800000
          
          # ğŸ”¥ æ ¸å¿ƒä¼˜åŒ–å‚æ•°
          ccache --set-config=sloppiness=file_macro,locale,time_macros,include_file_ctime,file_stat_matches,include_file_mtime,pch_defines
          ccache --set-config=hash_dir=false
          ccache --set-config=direct_mode=true
          ccache --set-config=base_dir="$PWD"
          ccache --set-config=temporary_dir="/tmp"
          ccache --set-config=run_second_cpp=false
          ccache --set-config=cpp_extension=true
          
          # æ¸…ç†ç»´æŠ¤
          ccache --cleanup >/dev/null 2>&1 || true
          
          echo "ğŸ“Š ccache é…ç½®:"
          ccache --show-config | grep -E "(max_size|max_files|compression|direct_mode)" || echo "é…ç½®åº”ç”¨ä¸­..."
          echo "ğŸ“Š åˆå§‹ç»Ÿè®¡:"
          ccache -s 2>/dev/null || echo "ccache åˆå§‹åŒ–ä¸­..."
      # ============================================
      # é…ç½®åº”ç”¨
      # ============================================
      - name: ğŸ¨ åº”ç”¨è‡ªå®šä¹‰é…ç½®
        env:
          LAN: ${{ github.event.inputs.lan_addr }}
          ROOT_PASSWORD: ${{ github.event.inputs.root_password }}
          ENABLE_DOCKER: ${{ github.event.inputs.docker == 'true' && 'y' || 'n' }}
          ENABLE_SSRP: ${{ github.event.inputs.ssrp == 'true' && 'y' || 'n' }}
          ENABLE_PASSWALL: ${{ github.event.inputs.passwall == 'true' && 'y' || 'n' }}
          ENABLE_NIKKI: ${{ github.event.inputs.nikki == 'true' && 'y' || 'n' }}
          ENABLE_OPENCLASH: ${{ github.event.inputs.openclash == 'true' && 'y' || 'n' }}
          ENABLE_LUCKY: ${{ github.event.inputs.lucky == 'true' && 'y' || 'n' }}
          ENABLE_OAF: ${{ github.event.inputs.oaf == 'true' && 'y' || 'n' }}
        run: |
          cd "$OPENWRT_PATH"
          
          # å¤åˆ¶è‡ªå®šä¹‰æ–‡ä»¶
          if [ -d "$GITHUB_WORKSPACE/files" ]; then
            cp -r "$GITHUB_WORKSPACE/files" .
          fi
          
          # åº”ç”¨é…ç½®æ–‡ä»¶
          cp "${{ github.workspace }}/$CONFIG_FILE" .config
          
          # æ‰§è¡Œè‡ªå®šä¹‰è„šæœ¬
          if [ -f "${{ github.workspace }}/$DIY_SCRIPT" ]; then
            chmod +x "${{ github.workspace }}/$DIY_SCRIPT"
            "${{ github.workspace }}/$DIY_SCRIPT"
          fi
          
          # æ‰§è¡Œé¢„è®¾è„šæœ¬
          for script in preset-mihimo-core.sh preset-adguard-core.sh; do
            if [ -f "${{ github.workspace }}/scripts/$script" ]; then
              chmod +x "${{ github.workspace }}/scripts/$script"
              "${{ github.workspace }}/scripts/$script" "$CLASH_KERNEL"
            fi
          done
          
          # ç”Ÿæˆæœ€ç»ˆé…ç½®
          make defconfig
          
          # æå–ç›®æ ‡ä¿¡æ¯
          DEVICE_TARGET=$(awk -F'"' '/^CONFIG_TARGET_BOARD=/{print $2}' .config || echo "x86")
          DEVICE_SUBTARGET=$(awk -F'"' '/^CONFIG_TARGET_SUBTARGET=/{print $2}' .config || echo "64")
          
          {
            echo "DEVICE_TARGET=$DEVICE_TARGET"
            echo "DEVICE_SUBTARGET=$DEVICE_SUBTARGET"
          } >> $GITHUB_ENV
          
          echo "ğŸ¯ æ„å»ºç›®æ ‡: $DEVICE_TARGET-$DEVICE_SUBTARGET"
          echo "ğŸ“¦ æ’ä»¶çŠ¶æ€:"
          echo "  Docker: $ENABLE_DOCKER"
          echo "  SSRP: $ENABLE_SSRP"
          echo "  Passwall: $ENABLE_PASSWALL"
          echo "  OpenClash: $ENABLE_OPENCLASH"
          echo "  å…¶ä»–: Nikki($ENABLE_NIKKI), Lucky($ENABLE_LUCKY), OAF($ENABLE_OAF)"
      # ============================================
      # å¼ºåˆ¶æ¸…ç†ï¼ˆå¯é€‰ï¼‰
      # ============================================
      - name: ğŸ§¹ å¼ºåˆ¶æ¸…ç†æ„å»ºç›®å½•
        if: github.event.inputs.force_clean == 'true'
        run: |
          cd "$OPENWRT_PATH"
          echo "ğŸ§¹ æ‰§è¡Œå¼ºåˆ¶æ¸…ç†..."
          
          cp .config .config.backup
          make dirclean
          cp .config.backup .config
          make defconfig
          
          # æ¸…ç†ccache
          export CCACHE_DIR="$PWD/.ccache"
          ccache -C
          
          echo "âœ… å¼ºåˆ¶æ¸…ç†å®Œæˆ"
      # ============================================
      # ä¸‹è½½ä¾èµ–
      # ============================================
      - name: ğŸ“¥ ä¸‹è½½ä¾èµ–åŒ…
        timeout-minutes: 30
        run: |
          cd "$OPENWRT_PATH"
          
          echo "ğŸ“¥ å¼€å§‹ä¸‹è½½ä¾èµ–åŒ…..."
          
          # ä¼˜åŒ–ä¸‹è½½å¹¶è¡Œåº¦
          DOWNLOAD_JOBS=$((COMPILE_JOBS * 2))
          DOWNLOAD_JOBS=$((DOWNLOAD_JOBS > 16 ? 16 : DOWNLOAD_JOBS))
          
          # é‡è¯•æœºåˆ¶çš„ä¸‹è½½
          for attempt in 1 2 3; do
            echo "ğŸ“¥ ä¸‹è½½å°è¯• $attempt/3 (å¹¶è¡Œåº¦: $DOWNLOAD_JOBS)"
            
            if make download -j"$DOWNLOAD_JOBS" 2>&1 | tee download.log; then
              echo "âœ… ä¸‹è½½å®Œæˆ"
              break
            else
              echo "âŒ ä¸‹è½½å¤±è´¥ï¼Œå°è¯•é‡æ–°ä¸‹è½½..."
              [ $attempt -lt 3 ] && sleep 10
            fi
          done
          
          # æ£€æŸ¥ä¸‹è½½ç»“æœ
          if grep -q "ERROR" download.log; then
            echo "âš ï¸ ä¸‹è½½è¿‡ç¨‹ä¸­æœ‰é”™è¯¯ï¼Œä½†ç»§ç»­ç¼–è¯‘..."
          fi
      # ============================================
      # æ™ºèƒ½ç¼–è¯‘ç­–ç•¥
      # ============================================
      - name: ğŸ”¨ æ™ºèƒ½ç¼–è¯‘å›ºä»¶
        id: compile
        timeout-minutes: 240
        run: |
          cd "$OPENWRT_PATH"
          
          # è®¾ç½®ç¼–è¯‘ç¯å¢ƒ
          export USE_CCACHE=1
          export CCACHE_DIR="$PWD/.ccache"
          export CONFIG_CCACHE=y
          export PATH="/usr/lib/ccache:$PATH"
          
          echo "ğŸš€ å¼€å§‹æ™ºèƒ½ç¼–è¯‘ ($(date))"
          echo "ğŸ“Š ç¼–è¯‘ç­–ç•¥: ${{ needs.pre-check.outputs.compile_strategy }}"
          echo "ğŸ’» CPUæ ¸å¿ƒ: $(nproc)"
          echo "ğŸ’¾ å¯ç”¨å†…å­˜: $(free -h | grep '^Mem:' | awk '{print $7}')"
          echo "ğŸ”§ ç¼–è¯‘å¹¶è¡Œåº¦: $COMPILE_JOBS"
          
          # ç¼–è¯‘å‰ccacheçŠ¶æ€
          echo "ğŸ“Š ç¼–è¯‘å‰ ccache çŠ¶æ€:"
          ccache -s 2>/dev/null || echo "ccache å‡†å¤‡ä¸­..."
          
          # æ ¹æ®ç­–ç•¥é€‰æ‹©ç¼–è¯‘æ–¹æ³•
          case "${{ needs.pre-check.outputs.compile_strategy }}" in
            "staged")
              # åˆ†é˜¶æ®µç¼–è¯‘ï¼ˆè·³è¿‡å·¥å…·é“¾ï¼‰
              echo "ğŸ”¨ é˜¶æ®µ1: ç›®æ ‡å¹³å°ç¼–è¯‘"
              make target/compile -j$COMPILE_JOBS || make target/compile -j1 V=s
              
              echo "ğŸ”¨ é˜¶æ®µ2: è½¯ä»¶åŒ…ç¼–è¯‘"
              PACKAGE_JOBS=$((COMPILE_JOBS < 8 ? COMPILE_JOBS : 8))
              make package/compile -j$PACKAGE_JOBS || make package/compile -j1 V=s
              
              echo "ğŸ”¨ é˜¶æ®µ3: å›ºä»¶ç»„è£…"
              make package/install target/install package/index -j$COMPILE_JOBS
              ;;
              
            "standard")
              # æ ‡å‡†ç¼–è¯‘
              echo "ğŸ”¨ æ ‡å‡†ç¼–è¯‘æ¨¡å¼"
              make -j$COMPILE_JOBS || make -j1 V=s
              ;;
              
            "full")
              # å®Œæ•´ç¼–è¯‘ï¼ˆæœ€ä¿å®ˆï¼‰
              echo "ğŸ”¨ å®Œæ•´ç¼–è¯‘æ¨¡å¼"
              make -j1 V=s
              ;;
          esac
          
          echo "âœ… ç¼–è¯‘å®Œæˆ"
          echo "status=success" >> $GITHUB_OUTPUT
          
          # ç¼–è¯‘åccacheç»Ÿè®¡
          echo "ğŸ“Š ç¼–è¯‘å ccache ç»Ÿè®¡:"
          ccache -s
      # ============================================
      # ç¼–è¯‘åå¤„ç†
      # ============================================
      - name: ğŸ“¦ æ•´ç†å›ºä»¶æ–‡ä»¶
        if: steps.compile.outputs.status == 'success'
        id: organize
        run: |
          cd "$OPENWRT_PATH/bin/targets"/*/*
          
          echo "ğŸ“¦ ç”Ÿæˆçš„æ–‡ä»¶:"
          ls -lah
          
          # æå–å†…æ ¸ç‰ˆæœ¬
          KERNEL_VERSION="unknown"
          if ls *.manifest 1> /dev/null 2>&1; then
            KERNEL_VERSION=$(grep "^kernel " *.manifest | head -1 | awk '{print $3}' | cut -d- -f1-2 || echo "unknown")
          fi
          
          # å¤åˆ¶æ„å»ºé…ç½®
          cp "$OPENWRT_PATH/.config" build.config
          
          # æ‰“åŒ…å†…æ ¸æ¨¡å—
          if [ -d packages ]; then
            tar -czf kernel-modules-${{ env.FILE_DATE }}.tar.gz packages/
            rm -rf packages
          fi
          
          # æ¸…ç†å¤šä½™æ–‡ä»¶
          rm -f feeds.buildinfo version.buildinfo *.manifest sha256sums
          
          # ç”Ÿæˆå›ºä»¶ä¿¡æ¯æ–‡ä»¶
          cat > firmware_info.json <<EOF
          {
            "build_date": "$BUILD_DATE",
            "build_version": "$BUILD_VERSION",
            "build_id": "$BUILD_ID",
            "kernel_version": "$KERNEL_VERSION",
            "target": "$DEVICE_TARGET",
            "subtarget": "$DEVICE_SUBTARGET",
            "lan_address": "${{ github.event.inputs.lan_addr }}",
            "root_password": "${{ github.event.inputs.root_password }}",
            "commit_hash": "$COMMIT_HASH",
            "commit_date": "$COMMIT_DATE",
            "compile_strategy": "${{ needs.pre-check.outputs.compile_strategy }}",
            "plugins": {
              "docker": ${{ github.event.inputs.docker }},
              "ssrp": ${{ github.event.inputs.ssrp }},
              "passwall": ${{ github.event.inputs.passwall }},
              "openclash": ${{ github.event.inputs.openclash }},
              "nikki": ${{ github.event.inputs.nikki }},
              "lucky": ${{ github.event.inputs.lucky }},
              "oaf": ${{ github.event.inputs.oaf }}
            }
          }
          EOF
          
          # ç”Ÿæˆå®‰è£…è¯´æ˜
          cat > README.md <<EOF
          # OpenWrt å›ºä»¶è¯´æ˜
          
          ## ğŸ¯ å›ºä»¶ä¿¡æ¯
          - **ç‰ˆæœ¬**: $BUILD_VERSION
          - **ç›®æ ‡**: $DEVICE_TARGET-$DEVICE_SUBTARGET  
          - **å†…æ ¸**: $KERNEL_VERSION
          - **ç¼–è¯‘æ—¶é—´**: $BUILD_DATE
          - **LANåœ°å€**: ${{ github.event.inputs.lan_addr }}
          - **é»˜è®¤å¯†ç **: ${{ github.event.inputs.root_password }}
          
          ## ğŸ“¦ åŒ…å«æ’ä»¶
          ${{ github.event.inputs.docker == 'true' && '- âœ… Docker' || '- âŒ Docker' }}
          ${{ github.event.inputs.ssrp == 'true' && '- âœ… ShadowSocksR Plus+' || '- âŒ ShadowSocksR Plus+' }}
          ${{ github.event.inputs.passwall == 'true' && '- âœ… Passwall' || '- âŒ Passwall' }}
          ${{ github.event.inputs.openclash == 'true' && '- âœ… OpenClash' || '- âŒ OpenClash' }}
          ${{ github.event.inputs.nikki == 'true' && '- âœ… Nikki' || '- âŒ Nikki' }}
          ${{ github.event.inputs.lucky == 'true' && '- âœ… Lucky' || '- âŒ Lucky' }}
          ${{ github.event.inputs.oaf == 'true' && '- âœ… OpenAppFilter' || '- âŒ OpenAppFilter' }}
          
          ## ğŸ“¥ å®‰è£…æ–¹æ³•
          
          ### UEFIå¯åŠ¨ï¼ˆæ¨èï¼‰:
          \`\`\`bash
          gunzip openwrt-*-generic-ext4-combined-efi.img.gz
          dd if=openwrt-*-generic-ext4-combined-efi.img of=/dev/sdX bs=4M status=progress
          \`\`\`
          
          ### ä¼ ç»ŸBIOSå¯åŠ¨:
          \`\`\`bash
          gunzip openwrt-*-generic-ext4-combined.img.gz  
          dd if=openwrt-*-generic-ext4-combined.img of=/dev/sdX bs=4M status=progress
          \`\`\`
          
          ### VMwareè™šæ‹Ÿæœº:
          ç›´æ¥ä½¿ç”¨ \`.vmdk\` æ–‡ä»¶åˆ›å»ºè™šæ‹Ÿæœº
          
          ## âš ï¸ æ³¨æ„äº‹é¡¹
          1. é¦–æ¬¡å¯åŠ¨åè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç 
          2. å»ºè®®å¤‡ä»½åŸæœ‰å›ºä»¶åå†åˆ·å†™
          3. åˆ·å†™å‰è¯·ç¡®è®¤ç¡¬ä»¶å…¼å®¹æ€§
          EOF
          
          {
            echo "firmware_path=$PWD"
            echo "kernel_version=$KERNEL_VERSION"
          } >> $GITHUB_OUTPUT
          
          echo "FIRMWARE_PATH=$PWD" >> $GITHUB_ENV
          echo "ğŸ“¦ å›ºä»¶æ•´ç†å®Œæˆï¼Œè·¯å¾„: $PWD"
      # ============================================
      # æ€§èƒ½ç»Ÿè®¡æŠ¥å‘Š
      # ============================================
      - name: ğŸ“Š æ„å»ºæ€§èƒ½æŠ¥å‘Š
        if: always()
        run: |
          cd "$OPENWRT_PATH" 2>/dev/null || cd .
          
          # è®¡ç®—æ„å»ºæ—¶é—´
          BUILD_END_TIME=$(date +%s)
          BUILD_DURATION=$((BUILD_END_TIME - BUILD_START_TIME))
          BUILD_DURATION_MIN=$((BUILD_DURATION / 60))
          BUILD_DURATION_SEC=$((BUILD_DURATION % 60))
          
          echo "======================================="
          echo "ğŸ“Š OpenWrt æ„å»ºæ€§èƒ½åˆ†ææŠ¥å‘Š"
          echo "======================================="
          echo "ğŸ• æ„å»ºå®Œæˆæ—¶é—´: $(date)"
          echo "â±ï¸ æ€»æ„å»ºæ—¶é—´: ${BUILD_DURATION_MIN}åˆ†${BUILD_DURATION_SEC}ç§’"
          echo "ğŸ·ï¸ æ„å»ºID: ${{ github.run_number }}"
          echo "ğŸŒ¿ OpenWrtåˆ†æ”¯: ${{ env.REPO_BRANCH }}"
          echo "ğŸ¯ ç¼–è¯‘ç­–ç•¥: ${{ needs.pre-check.outputs.compile_strategy }}"
          echo "ğŸ”§ é…ç½®Hash: ${{ needs.pre-check.outputs.config_hash }}"
          echo "ğŸ“¦ ç›®æ ‡å¹³å°: ${DEVICE_TARGET:-unknown}-${DEVICE_SUBTARGET:-unknown}"
          echo ""
          
          # ccache è¯¦ç»†ç»Ÿè®¡
          echo "ğŸ¯ ccache æ€§èƒ½åˆ†æ:"
          if command -v ccache >/dev/null 2>&1; then
            export CCACHE_DIR="$PWD/.ccache"
            
            # è·å–ç»Ÿè®¡æ•°æ®
            STATS=$(ccache -s 2>/dev/null || echo "ç»Ÿè®¡ä¸å¯ç”¨")
            echo "$STATS"
            
            # è®¡ç®—å‘½ä¸­ç‡
            if echo "$STATS" | grep -q "cache hit"; then
              DIRECT_HITS=$(echo "$STATS" | grep "cache hit (direct)" | awk '{print $4}' 2>/dev/null || echo "0")
              PREPROCESSED_HITS=$(echo "$STATS" | grep "cache hit (preprocessed)" | awk '{print $4}' 2>/dev/null || echo "0")
              TOTAL_HITS=$((DIRECT_HITS + PREPROCESSED_HITS))
              MISSES=$(echo "$STATS" | grep "cache miss" | awk '{print $3}' 2>/dev/null || echo "1")
              
              if [ "$MISSES" != "0" ] && [ "$TOTAL_HITS" != "0" ]; then
                HIT_RATE=$(echo "scale=2; $TOTAL_HITS * 100 / ($TOTAL_HITS + $MISSES)" | bc -l 2>/dev/null || echo "N/A")
                echo ""
                echo "ğŸ“ˆ ç¼“å­˜æ•ˆç‡åˆ†æ:"
                echo "  ğŸ¯ æ€»å‘½ä¸­ç‡: ${HIT_RATE}%"
                echo "  âš¡ ç›´æ¥å‘½ä¸­: $DIRECT_HITS"
                echo "  ğŸ”„ é¢„å¤„ç†å‘½ä¸­: $PREPROCESSED_HITS"
                echo "  âŒ ç¼“å­˜æœªå‘½ä¸­: $MISSES"
                
                # æ€§èƒ½è¯„çº§
                if [ "$(echo "$HIT_RATE >= 75" | bc -l 2>/dev/null)" = "1" ]; then
                  echo "  ğŸ† æ€§èƒ½è¯„çº§: ä¼˜ç§€ (â‰¥75%)"
                elif [ "$(echo "$HIT_RATE >= 60" | bc -l 2>/dev/null)" = "1" ]; then
                  echo "  ğŸ¥ˆ æ€§èƒ½è¯„çº§: è‰¯å¥½ (â‰¥60%)"
                elif [ "$(echo "$HIT_RATE >= 40" | bc -l 2>/dev/null)" = "1" ]; then
                  echo "  ğŸ¥‰ æ€§èƒ½è¯„çº§: ä¸€èˆ¬ (â‰¥40%)"
                else
                  echo "  ğŸ“‰ æ€§èƒ½è¯„çº§: éœ€ä¼˜åŒ– (<40%)"
                fi
              fi
            fi
          else
            echo "ccache ä¸å¯ç”¨"
          fi
          
          echo ""
          echo "ğŸ’¾ ç¼“å­˜ç›®å½•å¤§å°åˆ†æ:"
          du -sh .ccache/ 2>/dev/null | awk '{print "ğŸ“¦ ccache: " $1}' || echo "ğŸ“¦ ccache: N/A"
          du -sh staging_dir/ 2>/dev/null | awk '{print "ğŸ”§ staging: " $1}' || echo "ğŸ”§ staging: N/A"
          du -sh build_dir/ 2>/dev/null | awk '{print "ğŸ—ï¸ build: " $1}' || echo "ğŸ—ï¸ build: N/A"
          du -sh dl/ 2>/dev/null | awk '{print "ğŸ“¥ downloads: " $1}' || echo "ğŸ“¥ downloads: N/A"
          
          echo ""
          echo "ğŸ¯ æ„å»ºäº§ç‰©:"
          if [ -d "bin/targets" ]; then
            find bin/targets -name "*.img.gz" -o -name "*.bin" -o -name "*.vmdk" | head -5 | sed 's/^/  âœ… /'
          else
            echo "  âŒ æœªæ‰¾åˆ°æ„å»ºäº§ç‰©"
          fi
          
          echo ""
          echo "ğŸ” ä¼˜åŒ–å»ºè®®:"
          if [ "$(echo "${HIT_RATE:-0} < 60" | bc -l 2>/dev/null)" = "1" ]; then
            echo "  ğŸ’¡ ç¼“å­˜å‘½ä¸­ç‡è¾ƒä½ï¼Œå»ºè®®æ£€æŸ¥é…ç½®å˜æ›´é¢‘ç‡"
          fi
          echo "  ğŸš€ ä¸‹æ¬¡ç¼–è¯‘é¢„è®¡æ—¶é—´: $((BUILD_DURATION_MIN / 3))-$((BUILD_DURATION_MIN / 2))åˆ†é’Ÿ"
          echo "======================================="
      # ============================================
      # ä¸Šä¼ å¤„ç†
      # ============================================
      - name: ğŸ“¤ ä¸Šä¼  Artifacts
        if: steps.compile.outputs.status == 'success' && env.UPLOAD_ARTIFACTS == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: OpenWrt-${{ env.DEVICE_TARGET }}-${{ env.FILE_DATE }}-${{ needs.pre-check.outputs.compile_strategy }}
          path: ${{ env.FIRMWARE_PATH }}
          retention-days: 30
          compression-level: 6
      - name: ğŸš€ åˆ›å»º Release
        if: steps.compile.outputs.status == 'success' && env.UPLOAD_RELEASE == 'true'
        uses: ncipollo/release-action@v1.14.0
        with:
          name: ${{ env.FILE_DATE }} â€¢ ${{ env.FIRMWARE_TAG }} â€¢ ${{ needs.pre-check.outputs.compile_strategy }}
          allowUpdates: true
          tag: ${{ env.FIRMWARE_TAG }}-${{ env.FILE_DATE }}-${{ needs.pre-check.outputs.compile_strategy }}
          token: ${{ secrets.GITHUB_TOKEN }}
          artifacts: ${{ env.FIRMWARE_PATH }}/*
          body: |
            ## ğŸ¯ OpenWrt å›ºä»¶å‘å¸ƒ [${{ env.BUILD_ID }}]
            
            > ğŸš€ **ç¼–è¯‘ç­–ç•¥**: `${{ needs.pre-check.outputs.compile_strategy }}` | ğŸ• **ç¼–è¯‘æ—¶é—´**: çº¦ ${{ needs.pre-check.outputs.compile_strategy == 'staged' && '3-4å°æ—¶' || '5-6å°æ—¶' }}
            
            ### ğŸ“Š å›ºä»¶ä¿¡æ¯
            | é¡¹ç›® | è¯¦æƒ… |
            |------|------|
            | **ğŸ·ï¸ ç‰ˆæœ¬** | `${{ env.BUILD_VERSION }}` |
            | **ğŸ“… æ—¥æœŸ** | `${{ env.BUILD_DATE }}` |
            | **ğŸ¯ ç›®æ ‡** | `${{ env.DEVICE_TARGET }}_${{ env.DEVICE_SUBTARGET }}` |
            | **ğŸ”§ å†…æ ¸** | `${{ steps.organize.outputs.kernel_version }}` |
            | **ğŸŒ LAN IP** | `${{ github.event.inputs.lan_addr }}` |
            | **ğŸ”‘ å¯†ç ** | `${{ github.event.inputs.root_password }}` |
            | **âš¡ ç¼–è¯‘æ¨¡å¼** | `${{ needs.pre-check.outputs.compile_strategy }}` |
            
            ### ğŸ“¦ é›†æˆæ’ä»¶
            | æ’ä»¶åç§° | çŠ¶æ€ | è¯´æ˜ |
            |---------|------|------|
            | ğŸ‹ Docker | ${{ github.event.inputs.docker == 'true' && 'âœ… å·²é›†æˆ' || 'âŒ æœªé›†æˆ' }} | å®¹å™¨åŒ–å¹³å° |
            | ğŸš€ ShadowSocksR Plus+ | ${{ github.event.inputs.ssrp == 'true' && 'âœ… å·²é›†æˆ' || 'âŒ æœªé›†æˆ' }} | ç§‘å­¦ä¸Šç½‘ |
            | ğŸŒ Passwall | ${{ github.event.inputs.passwall == 'true' && 'âœ… å·²é›†æˆ' || 'âŒ æœªé›†æˆ' }} | ä»£ç†å·¥å…· |
            | âš¡ OpenClash | ${{ github.event.inputs.openclash == 'true' && 'âœ… å·²é›†æˆ' || 'âŒ æœªé›†æˆ' }} | Clashå®¢æˆ·ç«¯ |
            | ğŸ“¦ Nikki | ${{ github.event.inputs.nikki == 'true' && 'âœ… å·²é›†æˆ' || 'âŒ æœªé›†æˆ' }} | ç³»ç»Ÿå·¥å…· |
            | ğŸ€ Lucky | ${{ github.event.inputs.lucky == 'true' && 'âœ… å·²é›†æˆ' || 'âŒ æœªé›†æˆ' }} | å¤šåŠŸèƒ½å·¥å…· |
            | ğŸ›¡ï¸ OpenAppFilter | ${{ github.event.inputs.oaf == 'true' && 'âœ… å·²é›†æˆ' || 'âŒ æœªé›†æˆ' }} | åº”ç”¨è¿‡æ»¤ |
            
            ### ğŸ“¥ å®‰è£…æŒ‡å—
            
            #### ğŸ–¥ï¸ UEFI ç³»ç»Ÿï¼ˆæ¨èï¼‰
            ```bash
            # è§£å‹å›ºä»¶
            gunzip openwrt-*-generic-ext4-combined-efi.img.gz
            
            # å†™å…¥Uç›˜/ç¡¬ç›˜ï¼ˆè¯·æ›¿æ¢ /dev/sdX ä¸ºå®é™…è®¾å¤‡ï¼‰
            sudo dd if=openwrt-*-generic-ext4-combined-efi.img of=/dev/sdX bs=4M status=progress
