name: ğŸ”§ Build OpenWrt Toolchain (GCC 15)

on:
  workflow_dispatch:
    inputs:
      model:
        description: 'ğŸ¯ Target Model'
        required: true
        default: 'x86_64'
        type: choice
        options:
          - x86_64
          - nanopi-r5s
          - netgear_r8500
          - redmi_ax6000
      libc:
        description: 'ğŸ“š C Library'
        required: true
        default: 'musl'
        type: choice
        options:
          - musl
          - glibc
      tools:
        description: 'ğŸ› ï¸ Build Tools'
        required: true
        default: 'ccache'
        type: choice
        options:
          - ccache
          - noccache
      gcc_version:
        description: 'ğŸ”§ GCC Version'
        required: true
        default: '15'
        type: choice
        options:
          - '13'
          - '14'
          - '15'

env:
  TZ: Asia/Shanghai
  DEBIAN_FRONTEND: noninteractive
  REPO_URL: https://github.com/openwrt/openwrt
  REPO_BRANCH: openwrt-24.10

permissions:
  contents: write
  actions: read

jobs:
  build:
    name: ğŸ”¨ ${{ github.event.inputs.model }}-${{ github.event.inputs.libc }}-gcc${{ github.event.inputs.gcc_version }}
    runs-on: ubuntu-24.04
    timeout-minutes: 360
    
    steps:
      # ============================================
      # 1. ç¯å¢ƒåˆå§‹åŒ–
      # ============================================
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: ğŸ”§ Set Time Zone
        run: sudo timedatectl set-timezone "$TZ"

      - name: ğŸ“Š Show System Information
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“Š System Information"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ–¥ï¸  OS: $(lsb_release -d | cut -f2)"
          echo "ğŸ”§ Kernel: $(uname -r)"
          echo "ğŸ’» CPU: $(nproc) cores"
          lscpu | grep "Model name" | cut -d':' -f2 | xargs echo "   "
          echo "ğŸ’¾ Memory: $(free -h | awk '/^Mem:/ {print $2}')"
          echo "ğŸ’¿ Disk: $(df -h / | awk 'NR==2 {print $4}') available"
          echo ""
          echo "ğŸ“‹ Build Configuration:"
          echo "  Model: ${{ github.event.inputs.model }}"
          echo "  C Library: ${{ github.event.inputs.libc }}"
          echo "  GCC Version: ${{ github.event.inputs.gcc_version }}"
          echo "  Build Tools: ${{ github.event.inputs.tools }}"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

      - name: ğŸ”§ Set Build Environment
        id: env
        run: |
          sudo mkdir -p /builder
          sudo chown -R runner:runner /builder
          echo "WORKDIR=/builder" >> $GITHUB_ENV
          
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          
          # ğŸ”¥ è®¡ç®—å·¥å…·é“¾æ¶æ„ï¼ˆä¸ build.sh å¯¹é½ï¼‰
          case "${{ github.event.inputs.model }}" in
            x86_64)
              TOOLCHAIN_ARCH="x86_64"
              ;;
            nanopi-r5s|redmi_ax6000)
              TOOLCHAIN_ARCH="aarch64_generic"
              ;;
            netgear_r8500)
              TOOLCHAIN_ARCH="arm_cortex-a9"
              ;;
            *)
              TOOLCHAIN_ARCH="x86_64"
              ;;
          esac
          
          echo "TOOLCHAIN_ARCH=$TOOLCHAIN_ARCH" >> $GITHUB_ENV
          echo "ğŸ“¦ Toolchain Architecture: $TOOLCHAIN_ARCH"

      # ============================================
      # 2. ç³»ç»Ÿä¼˜åŒ–
      # ============================================
      - name: ğŸ§¹ Free Disk Space
        uses: sbwml/actions@free-disk
        with:
          build-mount-path: /builder

      - name: ğŸ› ï¸ Build System Setup
        uses: sbwml/actions@openwrt-build-setup

      - name: ğŸ“¦ Install LLVM
        uses: sbwml/actions@install-llvm

      # ============================================
      # 3. å…‹éš† OpenWrt æºç 
      # ============================================
      - name: ğŸ“¥ Clone OpenWrt Source
        working-directory: /builder
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“¥ Cloning OpenWrt Source"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "Repository: $REPO_URL"
          echo "Branch: $REPO_BRANCH"
          echo ""
          
          for attempt in 1 2 3; do
            echo "ğŸ“¥ Clone attempt $attempt/3..."
            if git clone --depth=1 "$REPO_URL" -b "$REPO_BRANCH" openwrt; then
              echo "âœ… Clone successful"
              break
            fi
            echo "âŒ Clone attempt $attempt failed"
            rm -rf openwrt
            if [ $attempt -lt 3 ]; then
              sleep 10
            else
              echo "âŒ All clone attempts failed"
              exit 1
            fi
          done
          
          cd openwrt
          echo "OPENWRT_PATH=$PWD" >> $GITHUB_ENV
          
          echo ""
          echo "ğŸ“‹ Source Information:"
          git log -1 --pretty=format:"  Commit: %H%n  Author: %an%n  Date: %ci%n  Message: %s"
          echo ""
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

      # ============================================
      # 4. æ›´æ–° Feeds
      # ============================================
      - name: ğŸ“š Update Feeds
        working-directory: /builder/openwrt
        run: |
          echo "ğŸ“š Updating feeds..."
          ./scripts/feeds update -a
          
          echo "ğŸ“¦ Installing feeds..."
          ./scripts/feeds install -a
          
          echo "âœ… Feeds configured"

      # ============================================
      # 5. åº”ç”¨ GCC 15 è¡¥ä¸
      # ============================================
      - name: ğŸ”§ Apply GCC 15 Patches
        working-directory: /builder/openwrt
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ”§ Applying GCC 15 Patches"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          
          # ğŸ”¥ åº”ç”¨ GCC 15 æ”¯æŒè¡¥ä¸
          PATCH_URL="https://raw.githubusercontent.com/zouchanggan/OpenWrt-Actions/main/doc/patch/gcc/200-toolchain-gcc-add-support-for-GCC-15.patch"
          
          echo "ğŸ“¥ Downloading GCC 15 patch..."
          if curl -sL "$PATCH_URL" -o /tmp/gcc15.patch; then
            echo "âœ… Patch downloaded"
            
            echo "ğŸ”§ Applying patch..."
            if patch -p1 < /tmp/gcc15.patch; then
              echo "âœ… Patch applied successfully"
            else
              echo "âŒ Patch application failed"
              exit 1
            fi
            
            rm -f /tmp/gcc15.patch
          else
            echo "âŒ Failed to download patch"
            exit 1
          fi
          
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

      # ============================================
      # 6. ç”Ÿæˆå·¥å…·é“¾é…ç½®
      # ============================================
      - name: âš™ï¸ Generate Toolchain Config
        working-directory: /builder/openwrt
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âš™ï¸ Generating Toolchain Configuration"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          
          # ğŸ”¥ åŸºç¡€é…ç½®ï¼ˆæ ¹æ®ç›®æ ‡å¹³å°ï¼‰
          case "${{ github.event.inputs.model }}" in
            x86_64)
              cat > .config <<EOF
          CONFIG_TARGET_x86=y
          CONFIG_TARGET_x86_64=y
          CONFIG_TARGET_x86_64_DEVICE_generic=y
          EOF
              ;;
            nanopi-r5s)
              cat > .config <<EOF
          CONFIG_TARGET_rockchip=y
          CONFIG_TARGET_rockchip_armv8=y
          CONFIG_TARGET_rockchip_armv8_DEVICE_friendlyarm_nanopi-r5s=y
          EOF
              ;;
            netgear_r8500)
              cat > .config <<EOF
          CONFIG_TARGET_bcm53xx=y
          CONFIG_TARGET_bcm53xx_generic=y
          CONFIG_TARGET_bcm53xx_generic_DEVICE_netgear_r8500=y
          EOF
              ;;
            redmi_ax6000)
              cat > .config <<EOF
          CONFIG_TARGET_mediatek=y
          CONFIG_TARGET_mediatek_filogic=y
          CONFIG_TARGET_mediatek_filogic_DEVICE_xiaomi_redmi-router-ax6000=y
          EOF
              ;;
          esac
          
          # ğŸ”¥ GCC é…ç½®
          cat >> .config <<EOF
          
          # GCC ${{ github.event.inputs.gcc_version }}
          CONFIG_DEVEL=y
          CONFIG_TOOLCHAINOPTS=y
          CONFIG_GCC_USE_VERSION_${{ github.event.inputs.gcc_version }}=y
          EOF
          
          # ğŸ”¥ C åº“é…ç½®
          if [ "${{ github.event.inputs.libc }}" = "glibc" ]; then
            cat >> .config <<EOF
          
          # glibc
          CONFIG_LIBC_USE_GLIBC=y
          EOF
          else
            cat >> .config <<EOF
          
          # musl
          CONFIG_LIBC_USE_MUSL=y
          EOF
          fi
          
          # ğŸ”¥ ccache é…ç½®
          if [ "${{ github.event.inputs.tools }}" = "ccache" ]; then
            cat >> .config <<EOF
          
          # ccache
          CONFIG_CCACHE=y
          EOF
          fi
          
          # ğŸ”¥ ä¼˜åŒ–é€‰é¡¹
          cat >> .config <<EOF
          
          # Optimizations
          CONFIG_KERNEL_BUILD_USER="github-actions"
          CONFIG_KERNEL_BUILD_DOMAIN="github.com"
          EOF
          
          echo "ğŸ“„ Generated .config:"
          cat .config
          echo ""
          
          # ç”Ÿæˆå®Œæ•´é…ç½®
          make defconfig
          
          echo "âœ… Configuration generated"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

      # ============================================
      # 7. ğŸ”¥ ç¼–è¯‘å·¥å…·é“¾
      # ============================================
      - name: ğŸ”¨ Compile Toolchain
        working-directory: /builder/openwrt
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ”¨ Compiling Toolchain"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          
          CORES=$(nproc)
          echo "ğŸ”§ Using $CORES CPU cores"
          echo ""
          
          # ç¼–è¯‘å·¥å…·é“¾
          echo "â±ï¸  Starting compilation (this may take 20-30 minutes)..."
          echo ""
          
          if make -j$CORES toolchain/compile V=s 2>&1 | tee /tmp/toolchain-build.log; then
            echo ""
            echo "âœ… Toolchain compilation successful"
          else
            echo ""
            echo "âŒ Toolchain compilation failed"
            echo ""
            echo "ğŸ“‹ Last 50 lines of build log:"
            tail -50 /tmp/toolchain-build.log
            exit 1
          fi
          
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

      # ============================================
      # 8. ğŸ”¥ æ‰“åŒ…å·¥å…·é“¾ï¼ˆä¿®å¤ç‰ˆï¼‰
      # ============================================
      - name: ğŸ“¦ Package Toolchain
        working-directory: /builder/openwrt
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“¦ Packaging Toolchain"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          
          # ğŸ”¥ åˆ›å»ºå·¥å…·é“¾ç¼“å­˜ç›®å½•
          mkdir -p toolchain-cache
          
          # ğŸ”¥ ç”Ÿæˆæ–‡ä»¶åï¼ˆä¸ build.sh å®Œå…¨ä¸€è‡´ï¼‰
          LIBC="${{ github.event.inputs.libc }}"
          TOOLCHAIN_ARCH="${{ env.TOOLCHAIN_ARCH }}"
          GCC_VERSION="${{ github.event.inputs.gcc_version }}"
          
          TOOLCHAIN_FILENAME="toolchain_${LIBC}_${TOOLCHAIN_ARCH}_gcc-${GCC_VERSION}.tar.zst"
          
          echo "ğŸ“‹ Toolchain Information:"
          echo "  Architecture: $TOOLCHAIN_ARCH"
          echo "  C Library: $LIBC"
          echo "  GCC Version: $GCC_VERSION"
          echo "  Filename: $TOOLCHAIN_FILENAME"
          echo ""
          
          # ğŸ”¥ æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨
          echo "ğŸ” Checking directories..."
          DIRS_TO_PACK=""
          
          if [ -d "build_dir/toolchain-"* ] 2>/dev/null; then
            DIRS_TO_PACK="$DIRS_TO_PACK ./build_dir/toolchain-*"
            echo "  âœ… build_dir/toolchain-* found"
          else
            echo "  âš ï¸  build_dir/toolchain-* not found"
          fi
          
          if [ -d "staging_dir/toolchain-"* ] 2>/dev/null; then
            DIRS_TO_PACK="$DIRS_TO_PACK ./staging_dir/toolchain-*"
            echo "  âœ… staging_dir/toolchain-* found"
          else
            echo "  âš ï¸  staging_dir/toolchain-* not found"
          fi
          
          if [ -d "staging_dir/host"* ] 2>/dev/null; then
            DIRS_TO_PACK="$DIRS_TO_PACK ./staging_dir/host*"
            echo "  âœ… staging_dir/host* found"
          else
            echo "  âš ï¸  staging_dir/host* not found"
          fi
          
          if [ -d "dl" ]; then
            DIRS_TO_PACK="$DIRS_TO_PACK ./dl"
            echo "  âœ… dl directory found"
          else
            echo "  âš ï¸  dl directory not found"
          fi
          
          if [ -d "tmp" ]; then
            DIRS_TO_PACK="$DIRS_TO_PACK ./tmp"
            echo "  âœ… tmp directory found"
          else
            echo "  âš ï¸  tmp directory not found"
          fi
          
          if [ -z "$DIRS_TO_PACK" ]; then
            echo ""
            echo "âŒ No directories to pack!"
            echo "ğŸ“‹ Available directories:"
            ls -la
            exit 1
          fi
          
          echo ""
          echo "ğŸ“¦ Directories to pack:$DIRS_TO_PACK"
          echo ""
          
          # ğŸ”¥ æ‰“åŒ…ï¼ˆä¿®å¤ç‰ˆ - ç§»é™¤ grep ç®¡é“ï¼‰
          echo "ğŸ“¦ Creating archive..."
          echo "   This may take several minutes..."
          echo ""
          
          # è®¡ç®—å¹¶è¡Œåº¦
          ZSTD_THREADS=$(nproc)
          
          # ğŸ”¥ å…³é”®ä¿®å¤ï¼šä½¿ç”¨ 2>&1 é‡å®šå‘ï¼Œä¸ä½¿ç”¨ grep ç®¡é“
          set +e  # ä¸´æ—¶ç¦ç”¨é”™è¯¯é€€å‡º
          tar -I "zstd -19 -T$ZSTD_THREADS" -cf "toolchain-cache/$TOOLCHAIN_FILENAME" $DIRS_TO_PACK 2>&1 | tee /tmp/tar.log
          TAR_EXIT_CODE=$?
          set -e  # é‡æ–°å¯ç”¨é”™è¯¯é€€å‡º
          
          # æ£€æŸ¥ tar é€€å‡ºç ï¼ˆå¿½ç•¥ "Removing leading" è­¦å‘Šï¼‰
          if [ $TAR_EXIT_CODE -eq 0 ] || grep -q "Removing leading" /tmp/tar.log; then
            echo ""
            echo "âœ… Archive created successfully"
            
            # æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
            if [ -f "toolchain-cache/$TOOLCHAIN_FILENAME" ]; then
              ARCHIVE_SIZE=$(du -h "toolchain-cache/$TOOLCHAIN_FILENAME" | cut -f1)
              echo ""
              echo "ğŸ“Š Archive Information:"
              echo "  Filename: $TOOLCHAIN_FILENAME"
              echo "  Size: $ARCHIVE_SIZE"
              echo "  Compression: zstd level 19"
              echo ""
              
              # éªŒè¯å‹ç¼©åŒ…
              echo "ğŸ” Verifying archive integrity..."
              if zstd -t "toolchain-cache/$TOOLCHAIN_FILENAME" >/dev/null 2>&1; then
                echo "âœ… Archive integrity verified"
              else
                echo "âŒ Archive integrity check failed"
                exit 1
              fi
              
              # ğŸ”¥ ç”Ÿæˆå·¥å…·é“¾ä¿¡æ¯æ–‡ä»¶
              cat > toolchain-cache/toolchain-info.txt <<EOF
          Toolchain Information
          =====================
          
          Build Date: $(date -u '+%Y-%m-%d %H:%M:%S UTC')
          Build Host: $(hostname)
          Build User: github-actions[bot]
          
          Target Configuration:
            Model: ${{ github.event.inputs.model }}
            Architecture: $TOOLCHAIN_ARCH
            C Library: $LIBC
            GCC Version: $GCC_VERSION
            Build Tools: ${{ github.event.inputs.tools }}
          
          OpenWrt Source:
            Repository: $REPO_URL
            Branch: $REPO_BRANCH
            Commit: $(git rev-parse HEAD)
          
          Archive:
            Filename: $TOOLCHAIN_FILENAME
            Size: $ARCHIVE_SIZE
            Compression: zstd -19
          
          Usage:
            tar -I "zstd -d" -xf $TOOLCHAIN_FILENAME
            cd openwrt
            mkdir -p bin
            find ./staging_dir/ -name '*' -exec touch {} \; >/dev/null 2>&1
            find ./tmp/ -name '*' -exec touch {} \; >/dev/null 2>&1
          EOF
              
              echo ""
              echo "ğŸ“„ Toolchain info saved to toolchain-info.txt"
              
              # å¯¼å‡ºå˜é‡
              echo "TOOLCHAIN_FILENAME=$TOOLCHAIN_FILENAME" >> $GITHUB_ENV
              echo "ARCHIVE_SIZE=$ARCHIVE_SIZE" >> $GITHUB_ENV
            else
              echo ""
              echo "âŒ Archive file not found after creation"
              exit 1
            fi
          else
            echo ""
            echo "âŒ Archive creation failed (exit code: $TAR_EXIT_CODE)"
            echo ""
            echo "ğŸ“‹ tar log:"
            cat /tmp/tar.log
            exit 1
          fi
          
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

      # ============================================
      # 9. ğŸ”¥ åˆ›å»º Release
      # ============================================
      - name: ğŸš€ Create Release
        uses: ncipollo/release-action@v1.14.0
        with:
          name: ğŸ”§ OpenWrt Toolchain - openwrt-24.10
          allowUpdates: true
          tag: openwrt-24.10
          commit: ${{ github.sha }}
          replacesArtifacts: true
          token: ${{ secrets.GITHUB_TOKEN }}
          artifacts: /builder/openwrt/toolchain-cache/*
          body: |
            ## ğŸ”§ é¢„ç¼–è¯‘å·¥å…·é“¾ - OpenWrt 24.10
            
            ### ğŸ“‹ æ„å»ºä¿¡æ¯
            | é¡¹ç›® | ä¿¡æ¯ |
            |------|------|
            | **æ„å»ºæ—¶é—´** | `${{ github.event.repository.updated_at }}` |
            | **ç›®æ ‡å¹³å°** | `${{ github.event.inputs.model }}` |
            | **æ¶æ„** | `${{ env.TOOLCHAIN_ARCH }}` |
            | **C åº“** | `${{ github.event.inputs.libc }}` |
            | **GCC ç‰ˆæœ¬** | `${{ github.event.inputs.gcc_version }}` |
            | **æ„å»ºå·¥å…·** | `${{ github.event.inputs.tools }}` |
            | **æ„å»ºç¯å¢ƒ** | Ubuntu 24.04 LTS |
            | **æ–‡ä»¶å¤§å°** | `${{ env.ARCHIVE_SIZE }}` |
            
            ### ğŸ“¦ å·¥å…·é“¾æ–‡ä»¶
            - **æ–‡ä»¶å**: `${{ env.TOOLCHAIN_FILENAME }}`
            - **å‹ç¼©æ ¼å¼**: zstd (level 19)
            - **ç”¨é€”**: åŠ é€Ÿ OpenWrt å›ºä»¶ç¼–è¯‘
            
            ### âœ¨ ç‰¹æ€§
            - âœ… **GCC ${{ github.event.inputs.gcc_version }}** ç¼–è¯‘å™¨
            - âœ… **${{ github.event.inputs.libc }}** C åº“
            - âœ… **${{ env.TOOLCHAIN_ARCH }}** æ¶æ„
            - âœ… å®Œæ•´çš„ staging_dir å’Œ build_dir
            - âœ… é¢„ä¸‹è½½çš„æºç åŒ… (dl ç›®å½•)
            
            ### ğŸš€ ä½¿ç”¨æ–¹æ³•
            
            #### æ–¹æ³• 1ï¼šåœ¨ GitHub Actions ä¸­ä½¿ç”¨
            ```yaml
            - name: ğŸ“¥ Download Prebuilt Toolchain
              env:
                GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
              run: |
                cd openwrt
                
                # ä¸‹è½½å·¥å…·é“¾
                gh release download openwrt-24.10 \
                  --repo ${{ github.repository }} \
                  --pattern "${{ env.TOOLCHAIN_FILENAME }}" \
                  --dir /tmp/toolchain
                
                # è§£å‹
                tar -I "zstd -d" -xf /tmp/toolchain/${{ env.TOOLCHAIN_FILENAME }}
                
                # æ›´æ–°æ—¶é—´æˆ³
                mkdir -p bin
                find ./staging_dir/ -name '*' -exec touch {} \; >/dev/null 2>&1
                find ./tmp/ -name '*' -exec touch {} \; >/dev/null 2>&1
                
                # æ¸…ç†
                rm -rf /tmp/toolchain
